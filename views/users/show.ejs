<%- include('../partials/header.ejs'); -%>

<div class="main-content">
  <!-- --------------------- searchbar & sidebar --------------------- -->
  <%- include('../partials/searchbar.ejs'); -%>
  <% if (locals?.userData?.bio && locals?.userData?.name || locals?.userData?.id == locals?.user?.id) { %>
    <%- include('../partials/sidebar.ejs', { userData: locals.userData }); -%>
  <% } %>
  <!-- --------------------- main content --------------------- -->
  <div class="container outline">
    <% if (locals.data && locals.data.length > 0) {  %>
      <% data.forEach((note) => { %>
        <div class="book-card">
          <div class="card-body">
            <p class="text-grey card-rating minimize-txt" style="justify-self: flex-start">Rating: <%= note.rating %>/10 given by <%= note.user_name %></p>
            <p class="text-grey card-read minimize-txt">Read:
            <% if (note.date_started && note.date_finished) { %>
              <%= formatDatesForDisplay(note.date_started, note.date_finished) %>
            <% } else if (note.date_finished) { %>
              <%= formatDatesForDisplay(null, note.date_finished) %>
            <% } %>
            </p>
            <% if (locals.user && note.user_id === locals.user.id) { %>
              <div class="card-buttons card-buttons-container">
                <form class="note-form" action="/notes/<%= note.id %>/edit" method="get">
                  <button class="button edit-button" type="submit">
                    <img class="edit-icon" src="/images/edit-button.png" title="edit" alt="edit" />
                  </button>
                </form>
                <form class="note-form" action="/notes/<%= note.id %>/delete" method="post">
                  <button class="button delete warp black" type="submit" title="delete" alt="delete"></button>
                </form>
              </div>
              <div class="private-container d-flex" style="justify-self: flex-end; gap: 8px;">
                <p><em>Private? </em></p>
                <form class="note-form private-edit-form" data-endpoint="/notes/<%= note.id %>/edit" method="POST">
                  <input type="hidden" name="_method" value="PATCH">
                  <label class="switch">
                    <input type="checkbox" class="form-control" name="private" data-field="private" <%= note.private ? 'checked' : '' %>>
                    <span class="slider round"></span>
                  </label>
                </form>
              </div>
            <% } %>
            <div class="card-title-author">
              <p class="text-black mb-0 minimize-txt"><strong><%= note.book_title %></strong></p>
              <p class="text-black card-author minimize-txt"><em><%= note.book_author %></em></p>
            </div>
            <p class="text-black mb-0 card-note minimize-txt" style="white-space: pre-line;">
              <img class="card-cover" src="<%= note.book_cover %>" alt="book cover">
              <%= note.summary %>
            </p>
            <p class="text-grey mb-0 card-year minimize-txt">Published: <%= note.book_year %></p>
            <form class="note-form" action="/notes/<%= note.id %>" method="get">
              <button class="main-button btn-lg card-button" type="submit" alt="View notes">Notes</button>
            </form>
          </div>
        </div>
      <% }); %>
    <% } else { %>
      <p>No titles available</p>
    <% } %>
  </div>
</div>

<%- include('../partials/footer.ejs'); -%>
